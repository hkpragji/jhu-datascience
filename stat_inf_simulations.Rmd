---
title: "Part I: Simulation Exercise"
subtitle: "for the Statistical Inference Course Project"
author: "Hiten Pragji"
date: "`r format(Sys.Date(), '%d-%m-%Y')`"
output: 
  pdf_document:
    toc: false
    number_sections: true
    latex_engine: xelatex
geometry: margin=0.45in
fontsize: 10pt
header-includes:
  - \usepackage{amsmath}
  - \usepackage{amssymb}
  - \usepackage{graphicx}
  - \usepackage[numbers]{natbib}
  - \usepackage{url}
  - \usepackage{caption}
  - \usepackage{notoccite}
  - \usepackage{enumitem}
  - \usepackage{caption}
  - \usepackage{xcolor}
  - \usepackage{titlesec}
  - \usepackage{parskip}
  - \usepackage{hyperref}
  - \usepackage{mathtools}
  - \usepackage{bm}
  - \usepackage{dsfont}
  - \usepackage{bigints}
  - \usepackage[nointlimits]{esint}
  - \usepackage{titlesec}
  - \titleformat*{\section}{\large\bfseries}
  - \titleformat*{\subsection}{\normalsize\bfseries}
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
# Load required libraries
library(dplyr)
library(ggplot2)
# Set chunk options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

\section{Overview}

In this project, we investigate the behaviour of the exponential distribution and the effect of averaging multiple exponential random variables using simulations in R. We will use the simulations to show that the distribution of multiple exponential random variables is approximately Gaussian, with a mean and standard deviation close to the theoretical values, illustrating the Central Limit Theorem.

The **exponential distribution** is a continuous probability distribution used to model the time between two successive events from a **Poisson** distribution with mean $\lambda$. It is defined by the average number of events within a unit interval and is usually written as $X \sim \text{exp}(\lambda)$. Examples of situations that can be modelled with the exponential distribution include the time between phone calls received, the decay time of an unstable particle, and the time until a random mutation occurs.

The probability density function (PDF) for the exponential distribution is given by

\begin{align}
  f(x) =
    \begin{cases}
      \lambda e^{-\lambda x}, & x > 0 \\
      0, & x \leq 0
    \end{cases}
\end{align}

The expected value of an exponentially distributed random variable X is given by $E(X) = 1/\lambda$ and the variance is $\text{Var}(X) = 1/\lambda^{2}$. As with the Poisson distribution, the mean and the standard deviation of the exponential distribution both equal $1/\lambda$.

\section{Visualising the exponential distribution}

We can easily see that the PDF is given by an exponential decay function scaled by the rate parameter $\lambda$.

```{r plot-exp-dist, fig.width=6.5, fig.height=3.5}
y_rexp <- data.frame(sim_values = rexp(n = 1000, rate = 1))
ggplot2::ggplot(y_rexp, aes(sim_values)) +
  ggplot2::geom_histogram(
    aes(y = ..density..),
    bins = 30,
    col = "black",
    fill = "lightgreen",
    alpha = 0.5
  ) +
  ggplot2::stat_function(fun = dexp, args = list(rate = 1), linewidth = 1, col = "red") +
  ggplot2::labs(
    title = bquote("Simulated Exponential PDF (" * lambda == 1 * ")"),
    x = "x",
    y = expression(f(x))
  ) +
  ggplot2::theme(plot.title = element_text(hjust = 0.5))
```

\section{Simulation}

\subsection{Simulating the exponential distribution}

Using Equation (9), the theoretical mean is $E(X) = 1/\lambda = 1/0.2 = 5$ and the theoretical variance is given by $\sigma^{2} = \frac{1}{n} \sum{(x_{i} - \bar{x})^{2}} = \frac{1}{40} \cdot \frac{1}{0.2^{2}} = 0.625$. Using the `rexp` function, we run 1000 simulations, each generating a sample from an exponential distribution.

```{r exp-sims, echo = TRUE, fig.width=6.5, fig.height=3.5}
# Set seed for reproducibility
set.seed(100)
# Set parameters
lambda <- 0.2
n_sample <- 40
n_sims <- 1000
# Run 1000 simulations each generating 40 exponential random variables
df_sim <- data.frame(vals = c(replicate(n_sims, rexp(n = n_sample, rate = lambda))))
# Plot empirical distribution of simulated random numbers
ggplot2::ggplot(df_sim, aes(vals)) +
  ggplot2::geom_histogram(
    aes(y = ..density..),
    binwidth = 0.75,
    col = "black",
    fill = "lightgreen",
    alpha = 0.5,
    linewidth = 0.1
  ) +
  ggplot2::labs(
    title = bquote("Empirical exponential distribution (n = 40) (" * lambda == 0.2 * ")"),
    x = "x",
    y = expression(f(x))
  ) +
  ggplot2::theme(plot.title = element_text(hjust = 0.5))
```

Let's run a large number of simulations to simulate the mean of 40 exponential random variables and then compare the sample mean and sample variance to the theoretical distribution.

```{r mean-simulation, echo = TRUE}
# Run 1000 simulations each generating the mean of 40 exponential random variables
df_sim_means <- data.frame(vals = c(replicate(n_sims, mean(rexp(n = n_sample, rate = lambda)))))
# Plot the empirical distribution of sample means
plot_sample_means <- ggplot2::ggplot(df_sim_means, aes(vals)) +
  ggplot2::geom_histogram(
    aes(y = ..density..),
    binwidth = 0.20,
    col = "black",
    fill = "lightblue",
    alpha = 0.5,
    linewidth = 0.1
  ) +
  ggplot2::scale_x_continuous(expand = c(0, 0), n.breaks = 10) +
  ggplot2::scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
  ggplot2::labs(
    title = bquote("Empirical distribution of means (n = 40) (" * lambda == 0.2 * ")"),
    x = "x",
    y = expression(bar(x))
  ) +
  ggplot2::theme(plot.title = element_text(hjust = 0.5))
```

\subsection{Sample mean versus theoretical mean}

```{r mean-comparison, echo = TRUE}
sample_mean <- mean(df_sim_means$vals, na.rm = TRUE)
sample_mean
```

We see that the sample mean $\bar{x} = 5.015545$ which is very close to the theoretical mean $\mu$.

\subsection{Sample variance versus theoretical variance}

```{r variance-comparison, echo = TRUE}
sample_variance <- var(df_sim_means$vals, na.rm = TRUE)
sample_variance
```

We see that the sample variance $s^{2} = 0.657945$ is very close to the theoretical variance $\sigma^{2}$.

\subsection{Distribution}

To illustrate the CLT, we can overlay the theoretical PDF of a normal distribution (`dnorm`) on the previous plot. 

```{r distribution, echo = TRUE, fig.width=6.5, fig.height=3.5}
plot_vlines <- data.frame(
  x = c(5, sample_mean),
  y = c(0.1, 0.2),
  labels = c("Theoretical mean", "Sample mean")
)
plot_sample_means +
  ggplot2::geom_function(fun = dnorm, args = list(mean = sample_mean, sd = sqrt(sample_variance))) +
  ggplot2::geom_vline(data = plot_vlines, aes(xintercept = x, colour = labels), show.legend = FALSE)
```

\section{Conclusion}

This simulation exercise demonstrates the CLT by showing that, as the sample size increases, the distribution of sample means from exponential random variables approaches a normal distribution, closely matching the empirical distribution observed in the simulation.
